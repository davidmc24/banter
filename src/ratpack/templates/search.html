<!doctype html>
<head>
    <meta charset="utf-8">
    <title>Banter History Search</title>
    <link rel="stylesheet" href="styles/banter.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/aui/5.4.3/aui/css/aui.css" media="all">
    <!--[if lt IE 9]><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/aui/5.4.3/aui/css/aui-ie.css" media="all"><![endif]-->
    <!--[if IE 9]><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/aui/5.4.3/aui/css/aui-ie9.css" media="all"><![endif]-->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/aui/5.4.3/aui/js/aui-soy.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/aui/5.4.3/aui/js/aui.js"></script>
    <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/aui/5.4.3/aui/js/aui-ie.js"></script><![endif]-->
</head>
<body>
<div id="page">
    <header id="header" role="banner">
        <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
            <div class="aui-header-inner">
                <div class="aui-header-primary">
                    <h1 id="logo" class="aui-header-logo aui-header-logo-textonly"><a href="/"><span class="aui-header-logo-device">Banter</span></a></h1>
                    <ul class="aui-nav">
                        <li><a href="/admin">Admin</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <section id="content" role="main">
        <header class="aui-page-header">
            <div class="aui-page-header-inner">
                <div class="aui-page-header-main">
                    <h1>History Search</h1>
                </div>
            </div>
        </header>
        <div class="aui-page-panel">
            <div class="aui-page-panel-inner">
                <section class="aui-page-panel-content">
                    <h2>History Search</h2>
                    <div class="search-box">
                    <form action="/search" method="GET" id="search-form" class="aui">
                        <input type="text" id="q" name="q" class="text" value="${model.q}"/>
                        <select class="select" id="channel" name="channel">
                            <option value="">All rooms</option>
                            <% for (channel in model.channels) { %>
                                <% if (channel == model.channel) { %>
                                <option selected="selected">${channel}</option>
                                <% } else { %>
                                <option>${channel}</option>
                                <% } %>
                            <% } %>
                        </select>
                        <input type="submit" value="Search" class="button"/>
                    </form>
                    </div>
                    <div class="search-results-container">
                        <div id="chats" class="search-results">
                            <% for (hit in model.hits.hits) { %>
                            <div class="search-result-container">
                                <div class="search-result">
                                    <div class="search-result-header">
                                        <h3>${hit.field("channel").value}</h3>
                                        <span class="time-ago" title="${hit.field('timestamp').dateTimeString}">${hit.field('timestamp').periodString} ago</span>
                                        <!-- TODO: time anchors -->
                                        <a href="/context?channel=${hit.field('channel').value.encodeURIComponent()}&q=${model.q.encodeURIComponent()}&timestamp=${hit.field('timestamp').dateTimeValue}">view Â»</a>
                                        <!--
                                        <form action="/context" method="GET">
                                            <input type="hidden" name="channel" value="${hit.field('channel').value}"/>
                                            <input type="hidden" name="query" value="${model.query}"/>
                                            <input type="hidden" name="timestamp" value="${hit.field('timestamp').dateTimeValue}">
                                            <input type="submit" value="view"/>
                                        </form>
                                        -->
                                    </div>
                                    <div class="chatBlock them">
                                        <table width="100%" cellspacing="0" cellpadding="0">
                                            <tbody><tr>
                                                <td class="nameBlock">
                                                    <p>${hit.field('realname').value}</p>
                                                </td>
                                                <td class="messageBlock">
                                                    <p class="timeBlock">${hit.field('timestamp').timeString}</p>
                                                    <p class="msgText">${hit.maybeHighlightedFieldValue('text')}</p>
                                                </td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <% } %>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </section>
</div>
</body>
</html>
